<div class="wrapper">
  <div class="row" *ngIf="showReport &&templateReport!=null" style="margin-top: 2px;">
    <div>
      <button
        *ngIf="!showSignatoriesEdit && templateReport.ReportId && templateReport.ValidToPrint && !verificationRequired && !hidePrintButton"
        class="btn btn-primary" style="
          display: inline-block;
          float: right;
          margin-right: 15px;
          cursor: pointer;
        " (click)="loading=true;Export('print')">
        Print <i class="fa fa-print"></i>
      </button>
    </div>
    <div #exportContent id="lab-report" class="padding-15-hr margin-50-tp">
      <div class="lab-rpt-container" id="lab-report-main">
        <div class="rpt-curholder">
          <div class="rep-containr" [ngClass]="hospitalCode">
            <div *ngIf="showPrintInfo" class="no-print margin-5-bt">
              <div class="flex-container txt-left">
                <div class="single-head">
                  <div *ngIf="templateReport.PrintedBy" class="display-blk margin-7-hr">
                    <strong>Last Printed By</strong> :
                    {{templateReport.PrintedByName}} , &nbsp;
                  </div>
                  <div *ngIf="templateReport.PrintCount" class="display-blk">
                    <div>
                      <strong>Print Count</strong> :
                      {{templateReport.PrintCount}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <table class="patient-info-tabl lab-report-tbl">
              <thead class="show-gap">
                <tr>
                  <td colspan="2">
                    <!--Note that if the Gap in the thead is greater than 254px, then we cannot get the heading on each page-->

                    <div *ngIf="showHeader" class="display-header">
                      <img class="headerimage" id="headerImg"
                        src="../../../themes/theme-default/images/mnk-customer-header-2.jpg" />
                    </div>
                    <div *ngIf="!showHeader && showGap" class="lab-header-gap"></div>
                  </td>
                </tr>
                <tr *ngIf="!showGap && !showHeader">
                  <td colspan="2" class="prelim-sig-holder">
                    <div class="patient-info-box" id="single-lab-report">
                      <div class="flex-container flex-align-center justify-sp-around">
                        <div class="single-head">
                          <div class="left-col-data">
                            <strong>Name</strong> :
                            {{templateReport.Lookups.PatientName}}
                          </div>
                        </div>
                        <div class="single-head">
                          <div class="right-col-data">
                            <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'"
                              style="position: relative;">
                              <div *ngIf="showBarCode" class="lab-barcode-holder" style="
                                  position: absolute;
                                  right: 2px;
                                  top: -2px;
                                ">
                                <danphe-bar-code [barcode-number]="templateReport.BarCodeNumber" [width]="1.5"
                                  [height]="24" [barcode-margin]="2" [text-margin]="0">
                                </danphe-bar-code>
                              </div>
                              <strong>Patient No.</strong> :
                              {{templateReport.Lookups.PatientCode}}
                              (<b>{{templateReport.Lookups.VisitTypeCode}}</b>)
                              <b *ngIf="hasInsurance"> / (Insurance)</b>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="flex-container flex-align-center justify-sp-around">
                        <div class="single-head">
                          <div class="left-col-data">
                            <strong>Address</strong> :
                            {{templateReport.Lookups.CountrySubDivisionName != null ?
                            templateReport.Lookups.CountrySubDivisionName + ',' : '' }}
                            {{templateReport.Lookups.MunicipalityName != null? templateReport.Lookups.MunicipalityName +
                            ',' : '' }}
                            {{templateReport.Lookups.Address}}
                          </div>
                        </div>
                        <div class="single-head">
                          <div class="right-col-data">
                            <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                              <strong>Age/Sex</strong> :
                              {{templateReport.Lookups.DOB |
                              DanpheDateTime:'age'}}
                              /{{templateReport.Lookups.Gender}}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="flex-container flex-align-center justify-sp-around">
                        <div class="referredby single-head">
                          <!--removed white-space: nowrap;-->
                          <div class="left-col-data">
                            <!--<strong>Referred By :  </strong> <input *ngIf="enableDrEdit" onkeypress="this.style.width = ((this.value.length + 1) * 8) + 'px';" id="docNameTextBox" type="text" [(ngModel)]="templateReport.Lookups.ReferredBy" (focusout)="makeDoctorEdit()" autofocus /> <span (click)="makeDoctorEdit()" *ngIf="!enableDrEdit">{{templateReport.Lookups.ReferredBy}}</span>-->
                            <strong>{{ referredByLabelInLabReport }} : </strong><span>{{templateReport.Lookups.ReferredBy}}</span>
                            <div *ngIf="securityService.HasPermission('btn-lab-report-referredby-edit')" data-html2canvas-ignore = "true" class="tooltip no-print">
                              <span (click)="openPopUpBox()">
                                <i class="fa fa-edit edit-ic"></i>
                              </span>
                              <p class="tooltiptext ttptextdown no-print">
                                Click to Change Referred By Dr.
                              </p>
                            </div>
                          </div>
                        </div>
                        <div class="single-head">
                          <div class="right-col-data">
                            <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                              <strong>Receiving Date</strong> :
                              {{templateReport.Lookups.ReceivingDate |
                              DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
                              ({{templateReport.Lookups.ReceivingDate |
                              nepaliDate }})
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="flex-container flex-align-center justify-sp-around">
                        <div class="single-head">
                          <div class="left-col-data">
                            <strong>Collection Site</strong> :
                            {{collectionSite}}
                          </div>
                        </div>
                        <div class="single-head">
                          <div class="right-col-data">
                            <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                              <strong>Testing Date</strong>
                              :{{templateReport.Lookups.ReportingDate |
                              DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
                              ({{templateReport.Lookups.ReportingDate |
                              nepaliDate }})
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="flex-container flex-align-center justify-sp-around">
                        <div class="single-head">
                          <div class="left-col-data">
                            <strong>Lab No</strong> :
                            {{templateReport.Lookups.SampleCodeFormatted}}
                            <div *ngIf="securityService.HasPermission('btn-lab-report-labnumber-edit')" data-html2canvas-ignore = "true" class="tooltip no-print">
                              <span (click)="ConfirmChangeRunNumber()">
                                <i class="fa fa-edit edit-ic"></i>
                              </span>
                              <p class="tooltiptext ttptextdown">
                                Click to Change Run Number.
                              </p>
                            </div>
                          </div>
                        </div>
                        <div class="single-head">
                          <div class="right-col-data">
                            <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                              <strong>Reporting Date</strong>
                              :{{templateReport.Lookups.VerifiedOn |
                              DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
                              ({{templateReport.Lookups.VerifiedOn |
                              nepaliDate }})
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="flex-container flex-align-center justify-sp-around">
                        <div class="single-head">
                          <div class="left-col-data">
                            <strong>Specimen</strong> :
                            {{templateReport.Lookups.Specimen}}
                          </div>
                        </div>
                      </div>
                    </div>
                    <div
                      *ngIf="templateReport.ReportId && verificationRequired && preliminarySignature && preliminarySignature.length > 0"
                      class="txt-prelim">
                      {{preliminarySignature}}
                    </div>
                  </td>
                </tr>
              </thead>
              <tfoot style="display: table-footer-group;">
                <tr>
                  <td colspan="2">
                    <div class="lab-qrholder text-center" *ngIf="qrCode && (qrCode.length > 0)">
                      <qr-code *ngIf="qrCode" [value]="qrCode" [size]="80" [backgroundAlpha]="0"></qr-code>
                    </div>
                    <div id="signatureList" class="lab-rpt-sign" *ngIf="templateReport.Signatories && showSignatories">
                      <div class="flex-container justify-sp-between all-signatures" style="align-items: flex-end;">
                        <ng-container *ngIf="templateReport.Signatories.length">
                          <div class="signature-item" *ngFor="let emp of templateReport.Signatories; let i=index;">
                            <div class="signature-image-holder"
                              *ngIf="showDigitalSignature && emp.SignatoryImageName && emp.SignatoryImageName.trim() != ''">
                              <div class="all-signature-images">
                                <button *ngIf="!hidePrintButton" id="hideSignImage{{i}}" data-html2canvas-ignore="true"
                                  [style.display]="emp.Show ? 'inline-block':'none'" (click)="ShowHideDigitalImage(emp)"
                                  class="close-btn no-print signature-image-remove">
                                  X
                                </button>
                                <button *ngIf="!hidePrintButton" id="showSignImage{{i}}"
                                  [style.display]="emp.Show ? 'none':'inline-block'" (click)="ShowHideDigitalImage(emp)"
                                  class="signature-image-show no-print">
                                  Show ESignature
                                </button>
                                <img class="labsignature-image" id="signImage{{i}}"
                                  [style.display]="emp.Show ? 'inline-block':'none'"
                                  src="../../../../../../fileuploads/EmployeeSignatures/{{emp.SignatoryImageName}}"
                                  alt="{{emp.EmployeeFullName}} Signature" />
                              </div>
                            </div>
                            <div class="signature-item-inside" [ngClass]="i>2 ? 'martop' : ''">
                              <div class="main-signature" *ngIf="emp.Signature" [innerHTML]="emp.Signature"></div>
                            </div>
                          </div>
                        </ng-container>
                        <ng-container
                          *ngIf="showVerifierSignature && verifierSignatureList && verifierSignatureList.length">
                          <div class="signature-item" *ngFor="let emp of verifierSignatureList; let i=index;">
                            <div class="signature-image-holder"
                              *ngIf="emp.SignatoryImageName && emp.SignatoryImageName.trim() != ''">
                              <div class="all-signature-images">
                                <img class="labsignature-image"
                                  src="../../../../../../fileuploads/EmployeeSignatures/{{emp.SignatoryImageName}}"
                                  alt="{{emp.EmployeeFullName}} Signature" />
                              </div>
                            </div>
                            <div class="signature-item-inside verifier-sign"
                              [ngClass]="templateReport.Signatories.length > 2 ? 'martop' : ''">
                              <div class="main-signature" *ngIf="emp.Signature" [innerHTML]="emp.Signature"></div>
                            </div>
                          </div>
                        </ng-container>
                        <div *ngIf="showReportDispatcherSignatory && CreatedByUser.LabSignature" class="signature-item">
                          <div class="signature-image-holder"
                            *ngIf="showDigitalSignature && CreatedByUser.SignatoryImageName && CreatedByUser.SignatoryImageName.trim() != ''">
                            <div class="all-signature-images">
                              <button id="hideCurrUserSignImage"
                                [style.display]="CreatedByUser.Show ? 'inline-block':'none'"
                                [ngStyle]="{'display':'inline-block'}" (click)="ShowHideDigitalImage(CreatedByUser)"
                                class="close-btn no-print signature-image-remove">
                                X
                              </button>
                              <button id="showCurrUserSignImage"
                                [style.display]="CreatedByUser.Show ? 'none':'inline-block'"
                                (click)="ShowHideDigitalImage(CreatedByUser)" class="signature-image-show no-print">
                                Show ESignature
                              </button>
                              <img class="labsignature-image" id="currUserSignImage"
                                [style.display]="CreatedByUser.Show ? 'inline-block':'none'"
                                src="../../../../../../fileuploads/EmployeeSignatures/{{CreatedByUser.SignatoryImageName}}"
                                alt="{{CreatedByUser.FullName}} Signature" />
                            </div>
                          </div>
                          <div class="signature-item-inside dispatcher-sign"
                            [ngClass]="templateReport.Signatories && templateReport.Signatories.length>2 ? 'martop' : ''">
                            <div class="main-signature" [innerHTML]="CreatedByUser.LabSignature"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="templateReport.ReportId && verificationRequired" class="prelim-note">
                      <p *ngIf="preliminaryText && preliminaryText.length > 0">
                        <em><strong>Note: </strong>{{preliminaryText}}</em>
                      </p>
                    </div>
                  </td>
                </tr>
              </tfoot>
              <ng-container>
                <tbody  *ngIf="showGap || showHeader">
                  <tr>
                    <td>
                      <div style="margin-bottom: 20px;">
                        <div class="patient-info-box" id="single-lab-report">
                          <div class="flex-container flex-align-center justify-sp-around">
                            <div class="single-head">
                              <div class="left-col-data">
                                <strong>Name</strong> :
                                {{templateReport.Lookups.PatientName}}
                              </div>
                            </div>
                            <div class="single-head">
                              <div class="right-col-data">
                                <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'"
                                  style="position: relative;">
                                  <div *ngIf="showBarCode" class="lab-barcode-holder" style="
                                      position: absolute;
                                      right: 2px;
                                      top: -2px;
                                    ">
                                    <danphe-bar-code [barcode-number]="templateReport.BarCodeNumber" [width]="1.5"
                                      [height]="24" [barcode-margin]="2" [text-margin]="0">
                                    </danphe-bar-code>
                                  </div>
                                  <strong>Patient No.</strong> :
                                  {{templateReport.Lookups.PatientCode}}
                                  (<b>{{templateReport.Lookups.VisitTypeCode}}</b>)
                                  <b *ngIf="hasInsurance"> / (Insurance)</b>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="flex-container flex-align-center justify-sp-around">
                            <div class="single-head">
                              <div class="left-col-data">
                                <strong>Address</strong> :
                                {{templateReport.Lookups.CountrySubDivisionName != null ?
                                templateReport.Lookups.CountrySubDivisionName + ',' : '' }}
                                {{templateReport.Lookups.MunicipalityName != null? templateReport.Lookups.MunicipalityName +
                                ',' : '' }}
                                {{templateReport.Lookups.Address}}
                              </div>
                            </div>
                            <div class="single-head">
                              <div class="right-col-data">
                                <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                                  <strong>Age/Sex</strong> :
                                  {{templateReport.Lookups.DOB |
                                  DanpheDateTime:'age'}}
                                  /{{templateReport.Lookups.Gender}}
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="flex-container flex-align-center justify-sp-around">
                            <div class="referredby single-head">
                              <!--removed white-space: nowrap;-->
                              <div class="left-col-data">
                                <!--<strong>Referred By :  </strong> <input *ngIf="enableDrEdit" onkeypress="this.style.width = ((this.value.length + 1) * 8) + 'px';" id="docNameTextBox" type="text" [(ngModel)]="templateReport.Lookups.ReferredBy" (focusout)="makeDoctorEdit()" autofocus /> <span (click)="makeDoctorEdit()" *ngIf="!enableDrEdit">{{templateReport.Lookups.ReferredBy}}</span>-->
                                <strong>{{ referredByLabelInLabReport }}: </strong><span>{{templateReport.Lookups.ReferredBy}}</span>
                                <div *ngIf="securityService.HasPermission('btn-lab-report-referredby-edit')" data-html2canvas-ignore = "true" class="tooltip no-print">
                                  <span (click)="openPopUpBox()">
                                    <i class="fa fa-edit edit-ic"></i>
                                  </span>
                                  <p class="tooltiptext ttptextdown no-print">
                                    Click to Change Referred By Dr.
                                  </p>
                                </div>
                              </div>
                            </div>
                            <div class="single-head">
                              <div class="right-col-data">
                                <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                                  <strong>Receiving Date</strong> :
                                  {{templateReport.Lookups.ReceivingDate |
                                  DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
                                  ({{templateReport.Lookups.ReceivingDate |
                                  nepaliDate }})
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="flex-container flex-align-center justify-sp-around">
                            <div class="single-head">
                              <div class="left-col-data">
                                <strong>Collection Site</strong> :
                                {{collectionSite}}
                              </div>
                            </div>
                            <div class="single-head">
                              <div class="right-col-data">
                                <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                                  <strong>Testing Date</strong>
                                  :{{templateReport.Lookups.ReportingDate |
                                  DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
                                  ({{templateReport.Lookups.ReportingDate |
                                  nepaliDate }})
                                </div>
                              </div>
                            </div>
                          </div>
    
                          <div class="flex-container flex-align-center justify-sp-around">
                            <div class="single-head">
                              <div class="left-col-data">
                                <strong>Lab No</strong> :
                                {{templateReport.Lookups.SampleCodeFormatted}}
                                <div *ngIf="securityService.HasPermission('btn-lab-report-labnumber-edit')" data-html2canvas-ignore = "true" class="tooltip no-print">
                                  <span (click)="ConfirmChangeRunNumber()">
                                    <i class="fa fa-edit edit-ic"></i>
                                  </span>
                                  <p class="tooltiptext ttptextdown">
                                    Click to Change Run Number.
                                  </p>
                                </div>
                              </div>
                            </div>
                            <div class="single-head">
                              <div class="right-col-data">
                                <div [ngClass]="showBarCode ? 'right-hdrwith-barcode right-hdr':'right-hdr'">
                                  <strong>Reporting Date</strong>
                                  :{{templateReport.Lookups.VerifiedOn |
                                  DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
                                  ({{templateReport.Lookups.VerifiedOn |
                                  nepaliDate }})
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="flex-container flex-align-center justify-sp-around">
                            <div class="single-head">
                              <div class="left-col-data">
                                <strong>Specimen</strong> :
                                {{templateReport.Lookups.Specimen}}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </ng-container>
       
     
              <!--Incase if template Type of a test is NOT html-->
              <ng-container *ngIf="templateReport.TemplateType != 'html'">
                <tbody style="display: table-row-group;">
         
                  <tr>
                    <td colspan="2" style="padding: 0;">
                      <!--Template Type != "Html"-->

                      <div class="table-holder">
                        <div>
                          <div class="flex-container">
                            <!--Table of a particular template-->
                            <table class="single-tempate-table lab-report-tbl border-around">
                              <ng-container *ngFor="let tmplate of templateReport.Templates; let i=index;">
                                <thead *ngIf="i==0">
                                  <tr>
                                    <th style="
                                        text-align: left;
                                        text-transform: none;
                                      " *ngIf="allColumnsCombined.Name">
                                      Test(s)
                                    </th>
                                    <th style="text-align: left;" *ngIf="allColumnsCombined.Result">
                                      Finding(s)
                                    </th>
                                    <th style="text-align: left;"
                                      *ngIf="showHideHighLowNormalFlag && tmplate.TemplateType=='normal'">
                                      Flag
                                    </th>
                                    <th style="text-align: left;" *ngIf="allColumnsCombined.Unit">
                                      Unit
                                    </th>
                                    <th style="text-align: left;" *ngIf="allColumnsCombined.Range">
                                      Ref. Range
                                    </th>
                                    <th style="text-align: left;" *ngIf="allColumnsCombined.Method">
                                      Method
                                    </th>
                                    <th style="text-align: left;" *ngIf="allColumnsCombined.Remarks">
                                      Remarks
                                    </th>
                                  </tr>
                                </thead>

                                <!--Contains all the tests of the template-->
                                <ng-container *ngIf="tmplate.TemplateType=='normal'">
                                  <tbody [ngClass]="tmplate.Print ? 'showInPrint' : 'tempate-table dontShowInPrint'">
                                    <tr>
                                      <td style="
                                          text-align: center;
                                          text-transform: uppercase;
                                        " class="frmt2-headertxt" [attr.colspan]="allColumnsCount">
                                        <strong>{{tmplate.HeaderText}}</strong>
                                      </td>
                                    </tr>
                                    <ng-container *ngFor="let res of tmplate.Tests; let rnum = index">
                                      <tr class="test-reportname-row"
                                        [ngClass]="res.Print ? 'showInPrint' : 'dontShowInPrint'"
                                        *ngIf="res.Components.length > 1 || res.Components[0].IsNegativeResult">
                                        <th *ngIf="allColumnsCombined.Name">
                                          <label class="margin-0-vr"
                                            for="{{res.ReportingName+rnum}}"><b>{{res.ReportingName}}</b></label>
                                          <input *ngIf="!hidePrintButton" id="{{res.ReportingName+rnum}}"
                                            class="dontShowInPrint outer-select" type="checkbox" [(ngModel)]="res.Print"
                                            name="showHideInPrint"
                                            (change)="ShowHidePrintForTestsWithComp(tmplate, res)"
                                            title="unchecked test will not be printed" />
                                        </th>
                                        <th *ngIf="allColumnsCombined.Result"></th>
                                        <th *ngIf="showHideHighLowNormalFlag && tmplate.TemplateType=='normal'"></th>
                                        <th *ngIf="allColumnsCombined.Unit"></th>
                                        <th *ngIf="allColumnsCombined.Range"></th>
                                        <th *ngIf="allColumnsCombined.Method"></th>
                                        <th *ngIf="allColumnsCombined.Remarks"></th>
                                      </tr>

                                      <!--Main result data addition work goes here-->
                                      <ng-container *ngIf="!res.Components[0].IsNegativeResult">
                                        <ng-container *ngFor="let cmp of res.Components; let idx = index;">
                                          <tr class="res-positive-rw"
                                            [ngClass]="cmp.Print ? 'showInPrint' : 'dontShowInPrint'">
                                            <td class="compname"
                                              *ngIf="allColumnsCombined.Name && cmp.ControlType == 'Label'"
                                              [style.padding-left]="7 + cmp.IndentationCount*7 + 'px'">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Name"></ng-container>
                                              <label class="margin-0-vr"
                                                for="{{cmp.ComponentName.split(' ').join('').trim()+idx}}"><b>
                                                  {{cmp.ComponentName}}</b></label>
                                              <input *ngIf="!hidePrintButton"
                                                id="{{cmp.ComponentName.split(' ').join('').trim()+idx}}"
                                                class="dontShowInPrint inner-select" name="showHideInPrint"
                                                type="checkbox" [(ngModel)]="cmp.Print"
                                                (change)="ShowHidePrintForTestsWithoutComp(tmplate,res, res.Components.length)"
                                                value="" title="unchecked test will not be printed" />
                                            </td>
                                            <td class="compname"
                                              *ngIf="allColumnsCombined.Name && cmp.ControlType != 'Label'"
                                              [style.padding-left]="7 + cmp.IndentationCount*7 + 'px'">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Name"></ng-container>
                                              <label
                                                [className]="res.Components.length == 1 ? 'margin-0-vr bold':'margin-0-vr'"
                                                for="{{cmp.ComponentName.split(' ').join('').trim()+idx}}">{{cmp.ComponentName}}</label>
                                              <input *ngIf="!hidePrintButton"
                                                id="{{cmp.ComponentName.split(' ').join('').trim()+idx}}"
                                                [className]="res.Components.length == 1 ? 'dontShowInPrint outer-select':'dontShowInPrint inner-select'"
                                                class="" name="showHideInPrint" type="checkbox" [(ngModel)]="cmp.Print"
                                                (change)="ShowHidePrintForTestsWithoutComp(tmplate,res, res.Components.length)"
                                                value="" title="unchecked test will not be printed" />
                                            </td>
                                            <td class="test-data-pstv result" *ngIf="allColumnsCombined.Result">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Result">
                                                <span *ngIf="!cmp.IsAbnormal">{{cmp.Value}}</span>
                                                <span *ngIf="cmp.IsAbnormal"><strong>{{cmp.Value}}</strong></span>
                                              </ng-container>
                                            </td>
                                            <td class="test-data-pstv flag"
                                              *ngIf="showHideHighLowNormalFlag && tmplate.TemplateType=='normal'">
                                              <span
                                                *ngIf="!cmp.ControlType || (cmp.ControlType && ((cmp.ControlType.toLowerCase() != 'searchbox') && (cmp.ControlType.toLowerCase() != 'label')))">
                                                <span *ngIf="cmp.AbnormalType && cmp.AbnormalType=='low'">L</span>
                                                <span *ngIf="cmp.AbnormalType && cmp.AbnormalType=='high'">H</span>
                                                <span *ngIf="cmp.AbnormalType && cmp.AbnormalType=='normal'">N</span>
                                              </span>
                                            </td>
                                            <td class="test-data-pstv unit" *ngIf="allColumnsCombined.Unit">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Unit">{{cmp.Unit}}
                                              </ng-container>
                                            </td>

                                            <!--We need to use InnerHTML and white-space:pre-line; to maintain the line Breaks, -->
                                            <td class="test-data-pstv range" *ngIf="allColumnsCombined.Range"
                                              [innerHTML]="cmp.RangeDescription"></td>
                                            <td class="test-data-pstv method" *ngIf="allColumnsCombined.Method">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Method">{{cmp.Method}}
                                              </ng-container>
                                            </td>
                                            <td class="test-data-pstv remarks" *ngIf="allColumnsCombined.Remarks">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Remarks">{{cmp.Remarks}}
                                              </ng-container>
                                            </td>
                                          </tr>
                                        </ng-container>
                                      </ng-container>
                                      <ng-container *ngIf="res.Components[0].IsNegativeResult">
                                        <ng-container *ngFor="let cmp of res.Components">
                                          <tr class="res-negative-rw"
                                            [ngClass]="cmp.Print ? 'showInPrint' : 'dontShowInPrint'">
                                            <td *ngIf="allColumnsCombined.Name" class="padding-15-hr">
                                              Result
                                            </td>
                                            <td *ngIf="allColumnsCombined.Result" class="padding-15-hr text-center">
                                              <ng-container *ngIf="tmplate.TemplateColumns.Result">{{cmp.Remarks}}
                                              </ng-container>
                                            </td>
                                            <td class="neg-data neg-unit" *ngIf="allColumnsCombined.Unit"></td>
                                            <td class="neg-data neg-range" *ngIf="allColumnsCombined.Range"></td>
                                            <td class="neg-data neg-method" *ngIf="allColumnsCombined.Method" style="
                                                border-right: 1px solid black;
                                              "></td>
                                            <td class="neg-data neg-remarks" *ngIf="allColumnsCombined.Remarks"></td>
                                          </tr>
                                        </ng-container>
                                      </ng-container>
                                      <ng-container>
                                        <!--to show Interpretation-->
                                        <tr [className]="res.PrintInterpretation ? 'showInPrint' : 'dontShowInPrint'"
                                          *ngIf="res.Interpretation != null && res.Interpretation != '' && res.Interpretation != undefined">
                                          <td [attr.colspan]="allColumnsCount">
                                            <div class="margin-15-vr">
                                              <div class="padding-7-hr">
                                                <input id="{{'interpretationTxt' + idx}}" *ngIf="!hidePrintButton"
                                                  class="dontShowInPrint outer-select" type="checkbox"
                                                  [(ngModel)]="res.PrintInterpretation" name="showHideInPrint"
                                                  (change)="ShowHideInterpretationToPrint(res)"
                                                  title="unchecked Interpretation will not be printed" />
                                                <label for="{{'interpretationTxt' + idx}}">
                                                  <b>Interpretation({{res.TestName}}):</b>
                                                </label>
                                                <div class="interpretation-txt-holder" [innerHTML]="res.Interpretation">
                                                </div>
                                              </div>
                                            </div>
                                          </td>
                                        </tr>
                                      </ng-container>
                                    </ng-container>

                                    <tr>
                                      <td [attr.colspan]="allColumnsCount">
                                          <div class="extra-gap"></div>
                                      </td>
                                    </tr>
                                  </tbody>
                                </ng-container>

                                <ng-container *ngIf="tmplate.TemplateType=='culture' && isCultureRptLoaded">
                                  <tbody [ngClass]="tmplate.Print ? 'showInPrint' : 'tempate-table dontShowInPrint'">
                                    <tr>
                                      <td style="padding: 0;" [attr.colspan]="allColumnsCount">
                                        <table class="culture-holder-table lab-report-tbl">
                                          <thead>
                                            <tr style="border:none;" class="culture-header">
                                              <th  style="
                                              text-align: center;
                                              text-transform: uppercase;
                                            " class="frmt2-headertxt" [attr.colspan]="allColumnsCount">
                                                {{tmplate.HeaderText}}
                                              </th>
                                            </tr>
                                          </thead>
                                          <ng-container *ngFor="let tst of tmplate.Tests">
                                            <tbody [ngClass]="tst.Print ? 'showInPrint' : 'dontShowInPrint'"
                                              class="culture-positive-testres" *ngIf="!tst.IsNegativeResult">
                                              <tr class="row-brdr not-bdr-cltr">
                                                <td colspan="3" style="padding: 0px 7px;">
                                                  <b>{{tst.ReportingName}}</b>
                                                  <input class="dontShowInPrint outer-select" type="checkbox"
                                                    *ngIf="!hidePrintButton" [(ngModel)]="tst.Print"
                                                    name="showHideInPrint"
                                                    (change)="ShowHidePrintForTestsWithComp(tmplate, tst)"
                                                    title="unchecked test will not be printed" />
                                                </td>
                                              </tr>
                                              <tr class="row-brdr not-bdr-cltr">
                                                <td colspan="3" style="padding: 0px 7px;">
                                                  <!--below is temporary solution until we get proper sample from server side: sud:5Sept'18-->
                                                  Specimen:
                                                  <input type="text" [(ngModel)]="tst.Specimen"
                                                    (focusout)="UpdateSpecimen(tst)" class="no-print" />
                                                  <span class="hidden">{{tst.Specimen}}</span>
                                                </td>
                                              </tr>
                                              <ng-container
                                                *ngFor="let culRepFormatted of tst.ResultFormattedForCulture; let c =index;">
                                                <tr class="row-brdr not-bdr-cltr">
                                                  <td style="padding: 0px 7px;">
                                                    <b>Result</b>
                                                  </td>
                                                  <td class="cs-result" colspan="2">
                                                    <b>{{culRepFormatted.IsolatedOrganism}}
                                                    </b>
                                                  </td>
                                                </tr>

                                                <ng-container *ngIf="culRepFormatted.HasOthersFields">
                                                  <tr class="row-brdr not-bdr-cltr"
                                                    *ngFor="let ot of culRepFormatted.Others">
                                                    <td style="padding: 0px 7px;" colspan="3">
                                                      <b>{{ot}}</b>
                                                    </td>
                                                  </tr>
                                                </ng-container>

                                                <tr *ngIf="culRepFormatted.ColonyCount.length > 0"
                                                  class="row-brdr not-bdr-cltr">
                                                  <td colspan="3" style="padding: 0px 7px;">
                                                    Colony Count:
                                                    <span>{{culRepFormatted.ColonyCount}}</span>
                                                  </td>
                                                </tr>

                                                <ng-container
                                                  *ngIf="culRepFormatted.MaxLenArray && culRepFormatted.MaxLenArray.length > 0">
                                                  <tr class="row-brdr not-bdr-cltr">
                                                    <td style="
                                                        padding: 0px 7px;
                                                        text-align: center;
                                                      " colspan="3">
                                                      <b>Antibiotics Result</b>
                                                    </td>
                                                  </tr>
                                                  <tr class="sensitiv-rst-hd">
                                                    <td><b>Sensitive</b></td>
                                                    <td *ngIf="showIntermediateInCultureRpt">
                                                      <b>Intermediate</b>
                                                    </td>
                                                    <td><b>Resistant</b></td>
                                                  </tr>
                                                  <tr class="sensitiv-rst-data"
                                                    *ngFor="let itm of culRepFormatted.MaxLenArray; let i=index;">
                                                    <td>
                                                      <span *ngIf="culRepFormatted.Sensitive.length>i">
                                                        {{culRepFormatted.Sensitive[i]}}
                                                      </span>
                                                    </td>
                                                    <td *ngIf="showIntermediateInCultureRpt">
                                                      <span *ngIf="culRepFormatted.Intermediate.length>i">
                                                        {{culRepFormatted.Intermediate[i]}}
                                                      </span>
                                                    </td>
                                                    <td>
                                                      <span *ngIf="culRepFormatted.Resistant.length>i">
                                                        {{culRepFormatted.Resistant[i]}}
                                                      </span>
                                                    </td>

                                                    <!--<td *ngIf="culRepFormatted.HasOthersFields">
                                                    <span *ngIf="culRepFormatted.Others.length>i">
                                                        {{culRepFormatted.Others[i]}}
                                                    </span>
                                                </td>-->
                                                  </tr>
                                                </ng-container>
                                              </ng-container>
                                            </tbody>
                                            <tbody [ngClass]="tst.Print ? 'showInPrint' : 'dontShowInPrint'"
                                              class="culture-negative-testres" *ngIf="tst.IsNegativeResult">
                                              <tr style="text-align: left;">
                                                <td colspan="3">
                                                  <b> {{tst.ReportingName}} </b>
                                                  <input class="dontShowInPrint outer-select" type="checkbox"
                                                    [(ngModel)]="tst.Print" name="showHideInPrint"
                                                    *ngIf="!hidePrintButton"
                                                    (change)="ShowHidePrintForTestsWithComp(tmplate, tst)"
                                                    title="unchecked test will not be printed" />
                                                </td>
                                              </tr>
                                              <tr>
                                                <td colspan="3">
                                                  <!--below is temporary solution until we get proper sample from server side: sud:5Sept'18-->
                                                  Specimen:
                                                  <input type="text" [(ngModel)]="tst.Specimen"
                                                    (focusout)="UpdateSpecimen(tst)" class="no-print" />
                                                  <span class="hidden">
                                                    {{tst.Specimen}}
                                                  </span>
                                                </td>
                                              </tr>
                                              <tr>
                                                <td *ngIf="tmplate.TemplateColumns.Name">
                                                  <b> Result </b>
                                                </td>
                                                <td class="text-center" colspan="2">
                                                  <b>
                                                    {{tst.NegativeResultText}}
                                                  </b>
                                                </td>
                                              </tr>
                                            </tbody>
                                          </ng-container>
                                        </table>
                                      </td>
                                    </tr>
                                  </tbody>
                                </ng-container>
                              </ng-container>
                            </table>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td colspan="2" style="padding: 0;">
                      <div *ngIf="showSignatoriesEdit" style="width: 95%;">
                        <p class="dontShowInPrint"><b>Comments: </b></p>
                        <textarea [(ngModel)]="templateReport.Comments" rows="4" style="width: 100%;"></textarea>
                      </div>
                      <div *ngIf="!showSignatoriesEdit && templateReport.Comments" style="width: 95%;">
                        <p style="font-weight: bold; margin: 0;">Comments:</p>
                        <p style="white-space: pre-line; margin: 0;" [innerHTML]="templateReport.Comments"></p>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </ng-container>

              <!--Incase if template Type of a test is html-->
              <ng-container *ngIf="templateReport.TemplateType == 'html'">
                <tbody class="border-around">
                  <tr>
                    <td colspan="2" style="padding: 0;">
                      <!--Template Type == "Html"-->

                      <div>
                        <div *ngFor="let template of templateReport.Templates;">
                          <div *ngFor="let test of template.Tests">
                            <div *ngFor="let comp of test.Components;">
                              <div style="text-align: justify;" class="htmlholder" *ngIf="comp.ValueHtml"
                                [innerHTML]="comp.ValueHtml"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </ng-container>
            </table>  
            <div *ngIf="templateReport.FooterText && templateReport.FooterText != ''"
              [className]="templateReport.PrintFooterText ? 'showInPrint footer-text-wrapper' : 'dontShowInPrint'">
              <input class="dontShowInPrint outer-select" id="footerTxt" type="checkbox" *ngIf="!hidePrintButton"
                [(ngModel)]="templateReport.PrintFooterText" />
              <label for="footerTxt" class="lab-footer-text" style="font-size: 10px; margin: 2px 0px; font-weight: 700;"
                [innerHTML]="templateReport.FooterText"></label>
            </div>
            <div *ngIf="showPrintInfo" class="report-print-info">
              Printed By: {{CreatedByUser.FullName}} on {{CurrentDateTime |
              DanpheDateTime:'format':'YYYY-MM-DD hh:mm A'}}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="templateReport && enableEdit" style="margin-top: 10px; padding-bottom: 50px; width: 100%; float: left;">
      <div class="lab-rpt-sign" *ngIf="showSignatoriesEdit" style="display: table;">
        <danphe-signatories ngDefaultControl [(ngModel)]="signatories" [defaultEmployeeIdList]="defaultSigEmpIdList"
          [displayMode]="'edit'" [departmentName]="'lab'">
        </danphe-signatories>
      </div>
      <div class="margin-20-tp">
        <div class="text-center" *ngIf="showSignatoriesEdit">
          <button class="btn green btn-success margin-7-hr" (click)="SubmitLabReport()" id="btnUpdateSignatories">
            Update Signatories {{ templateReport.ReportId ? '' : 'and Print'}}
            <i class="fa fa-print"></i>
          </button>
        </div>
        <div class="text-center" *ngIf="!showSignatoriesEdit && templateReport.ReportId">
          <button id="btnVerify" [disabled]="loading" *ngIf="verificationRequired"
            class="btn green btn-success margin-7-hr" (click)="Verify()"
            [rbac-permission]="{'name':'lab-verifier','actionOnInvalid':'remove'}">
            Verify <i class="fa fa-check"></i>
          </button>
          <button *ngIf="IsTeleMedicineEnabled && showUplaodToTeleMedicine" [ngClass]="(templateReport.IsFileUploadedToTeleMedicine || IsFileUploaded)? 'btn btn-danger margin-7-hr':'btn btn-success margin-7-hr'"
          id="btnUplaod" (click)="loading = true; callBackUpload()" [disabled]="loading">
          Upload To Patient Portal <i class="fa fa-upload"></i>
          </button>
          <button *ngIf="templateReport.ValidToPrint && !verificationRequired" class="btn green btn-success margin-7-hr"
            id="btnPrint" (click)="loading=true;Export('print')">
            Print <i class="fa fa-print"></i>
          </button>
          <button [disabled]="loading" *ngIf="templateReport.ReportId && verificationRequired"
            id="btnPrintPreliminaryReport" class="btn green btn-success margin-7-hr"
            (click)="loading=true;printLabReport('preliminary')">
            Print Preliminary Report <i class="fa fa-print"></i>
          </button>
          <button class="btn btn-cancel margin-7-hr" (click)="showSignatoriesEdit=true">
            Edit Signatories <i class="fa fa-edit"></i>
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="templateReport && !enableEdit && !hidePrintButton"
      style="margin-top: 10px; padding-bottom: 50px; width: 100%;">
      <div class="margin-20-tp text-center">
        <button [disabled]="loading" *ngIf="templateReport.ValidToPrint && !verificationRequired"
          class="btn btn-primary margin-7-hr" (click)="loading=true;printLabReport()">
          Print <i class="fa fa-print"></i>
        </button>
      </div>
    </div>
    <div class="popup-static portlet box portlet-fullscreen" *ngIf="showPopUp">
      <div class="portlet-body form">
        <div class="col-md-6 col-md-offset-3">
          <div class="modelbox-div">
            <div class="modelbox-header">
              <h4 class="margin-0-vr">
                <strong>Change Referred By doctor</strong>
              </h4>
            </div>
            <div class="modelbox-body">
              <div class="row margin-15-vr">
                <div class="col-md-3">
                  <label class="ref-label" for="refDoctor"><strong>Select Referrer</strong></label>
                </div>
                <div class="col-md-8">
                  <!--<input class="form-control" danphe-auto-complete
                id="refDoctor"
                [(ngModel)]="doctorSelected"
                [source]="doctorsList"
                [list-formatter]="AssignedToDocListFormatter"
                placeholder="Enter Doctor Name"
                display-property-name="FullName"
                value-property-name=null
                match-formatted="true"
                onClick="this.select();"
                max-num-list="10" />-->

                  <select-referrer [selected-ref-id]="selectedRefId" [allow-external]="ExtRefSettings.EnableExternal"
                    [allow-free-text]="ExtRefSettings.AllowFreeText" [default-external]="ExtRefSettings.DefaultExternal"
                    [display-property-name]="'LongSignature'" (on-referrer-change)="OnReferrerChanged($event)">
                  </select-referrer>
                </div>
              </div>
            </div>
            <div class="modelbox-footer">
              <div class="all-buttons text-right">
                <button type="button" class="btn btn-primary btn-sm margin-7-hr" (click)="AssignSelectedDoctor()">
                  Change
                </button>
                <button type="button" class="btn btn-cancel btn-sm margin-7-hr" (click)="closePopUpBox()">
                  Cancel
                </button>
              </div>
            </div>
            <div class="close-modelbox">
              <button class="btn btn-danger" (click)="closePopUpBox()">
                X
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="popup-static portlet box portlet-fullscreen" *ngIf="showChangeSample">
      <div class="portlet-body form">
        <div class="col-md-6 col-md-offset-3">
          <div class="modelbox-div">
            <div class="modelbox-header">
              <h4 class="margin-0-vr"><strong>Change Run Number</strong></h4>
            </div>
            <div class="modelbox-body">
              <div class="row">
                <div class="col-md-5">Sample Collection Date</div>
                <div class="col-md-7">
                  <danphe-date-picker [(ngModel)]="sampleCode.SampleCreatedOn" ngDefaultControl [CalendarTypes]="'np'"
                    (ngModelChange)="SampleDateChanged()"></danphe-date-picker>
                </div>
              </div>
              <div class="row margin-15-tp">
                <div class="col-md-5 text-capitalize">
                  {{RunNumberType}} ({{visitType}}) Run Number
                </div>
                <div class="col-md-7">
                  <input [(ngModel)]="sampleCode.RunNumber" style="
                      width: 100px;
                      height: 31px;
                      font-size: 20px;
                      font-weight: 700;
                      text-align: center;
                      display: inline-block;
                    " min="1" class="form-control cstm-form-control" name="Run Number" type="number" />
                  <!--<span style="font-size: 20px;font-weight: 700;text-align: center;">&nbsp;&nbsp;/&nbsp;&nbsp;</span>-->
                  <!--<input [(ngModel)]="sampleCode.SampleCode"
                       disabled
                       style="width: 80px;height: 31px;font-size: 20px;font-weight: 700;text-align: center;display:inline-block;"
                       min="0"
                       class="form-control cstm-form-control "
                       name="Sample Created On"
                       type="text">-->
                </div>
              </div>
            </div>
            <div class="modelbox-footer">
              <div class="all-buttons text-right">
                <button type="button" [disabled]="showConfirmationBox" class="btn btn-primary btn-sm margin-7-hr"
                  (click)="CheckIfSampleCodeExist()">
                  Update
                </button>
                <button type="button" class="btn btn-cancel btn-sm margin-7-hr" (click)="showChangeSample=false;">
                  Close
                </button>
              </div>
            </div>
            <div class="close-modelbox">
              <button class="btn btn-danger" (click)="showChangeSample=false;">
                X
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="popup-static portlet box portlet-fullscreen" *ngIf="showConfirmationBox">
      <div class="portlet-body form">
        <div class="col-md-6 col-md-offset-3">
          <div class="modelbox-div">
            <div class="modelbox-header text-center">
              <h4 class="margin-0-vr text-danger">
                <strong>Alert !!!</strong>
              </h4>
            </div>
            <div class="modelbox-body">
              <div *ngIf="templateReport.Lookups.PatientId != sampleCodeExistingDetail.PatientId">
                <div>
                  <p *ngIf="visitType && visitType.toLowerCase()=='outpatient'">
                    <span style="text-transform: capitalize;">{{visitType}}</span>
                    Run Number
                    <b>{{sampleCode.RunNumber}} / {{sampleCode.SampleCode}}</b>
                    is already used for patient
                    <b>{{sampleCodeExistingDetail.PatientName}}</b>
                  </p>
                  <p *ngIf="visitType && visitType.toLowerCase()==='inpatient'">
                    <span style="text-transform: capitalize;">{{visitType}}</span>
                    Run Number <b>{{sampleCode.RunNumber}}</b> is already used
                    for patient <b>{{sampleCodeExistingDetail.PatientName}}</b>
                  </p>
                  <p *ngIf="visitType && visitType.toLowerCase()==='emergency'">
                    <span style="text-transform: capitalize;">{{visitType}}</span>
                    Run Number <b>{{sampleCode.RunNumber}}</b> is already used
                    for patient <b>{{sampleCodeExistingDetail.PatientName}}</b>
                  </p>
                  <p>Please select another run number.</p>
                </div>
                <div class="modelbox-footer">
                  <div class="all-buttons text-right">
                    <button type="button" class="btn btn-cancel btn-sm margin-7-hr" (click)="showConfirmationBox=false">
                      Close
                    </button>
                  </div>
                </div>
              </div>
              <div *ngIf="templateReport.Lookups.PatientId == sampleCodeExistingDetail.PatientId">
                <div>
                  <p *ngIf="visitType && visitType.toLowerCase()=='outpatient'">
                    {{visitType}} Run Number
                    <b>{{sampleCode.RunNumber}} / {{sampleCode.SampleCode}}</b>
                    is already used for another test for the same
                    patient<b>({{sampleCodeExistingDetail.PatientName}})</b>
                  </p>
                  <p *ngIf="visitType && visitType.toLowerCase()=='inpatient'">
                    {{visitType}} Run Number <b>{{sampleCode.RunNumber}}</b> is
                    already used for another test for the same patient<b>({{sampleCodeExistingDetail.PatientName}})</b>
                  </p>
                  <p *ngIf="visitType && visitType.toLowerCase()==='emergency'">
                    <span style="text-transform: capitalize;">{{visitType}}</span>
                    Run Number <b>{{sampleCode.RunNumber}}</b> is already used
                    for patient <b>{{sampleCodeExistingDetail.PatientName}}</b>
                  </p>
                  <p>Do you want to continue with the same run number?</p>
                </div>
                <div class="modelbox-footer">
                  <div class="all-buttons text-right">
                    <button type="button" class="btn btn-primary btn-sm margin-7-hr" (click)="UpdateSampleCode()">
                      Continue
                    </button>
                    <button type="button" class="btn btn-cancel btn-sm margin-7-hr" (click)="showConfirmationBox=false">
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="close-modelbox">
              <button class="btn btn-danger" (click)="showConfirmationBox=false;">
                X
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>